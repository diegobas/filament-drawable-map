function x(h,e,i,n){function p(l){return l instanceof i?l:new i(function(o){o(l)})}return new(i||(i=Promise))(function(l,o){function t(d){try{r(n.next(d))}catch(u){o(u)}}function s(d){try{r(n.throw(d))}catch(u){o(u)}}function r(d){d.done?l(d.value):p(d.value).then(t,s)}r((n=n.apply(h,e||[])).next())})}function L(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var S=function h(e,i){if(e===i)return!0;if(e&&i&&typeof e=="object"&&typeof i=="object"){if(e.constructor!==i.constructor)return!1;var n,p,l;if(Array.isArray(e)){if(n=e.length,n!=i.length)return!1;for(p=n;p--!==0;)if(!h(e[p],i[p]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(l=Object.keys(e),n=l.length,n!==Object.keys(i).length)return!1;for(p=n;p--!==0;)if(!Object.prototype.hasOwnProperty.call(i,l[p]))return!1;for(p=n;p--!==0;){var o=l[p];if(!h(e[o],i[o]))return!1}return!0}return e!==e&&i!==i},P=L(S),k="__googleMapsScriptId",m;(function(h){h[h.INITIALIZED=0]="INITIALIZED",h[h.LOADING=1]="LOADING",h[h.SUCCESS=2]="SUCCESS",h[h.FAILURE=3]="FAILURE"})(m||(m={}));var g=class{constructor({apiKey:e,authReferrerPolicy:i,channel:n,client:p,id:l=k,language:o,libraries:t=[],mapIds:s,nonce:r,region:d,retries:u=3,url:y="https://maps.googleapis.com/maps/api/js",version:a}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=i,this.channel=n,this.client=p,this.id=l||k,this.language=o,this.libraries=t,this.mapIds=s,this.nonce=r,this.region=d,this.retries=u,this.url=y,this.version=a,g.instance){if(!P(this.options,g.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(g.instance.options)}`);return g.instance}g.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?m.FAILURE:this.done?m.SUCCESS:this.loading?m.LOADING:m.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){let e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((e,i)=>{this.loadCallback(n=>{n?i(n.error):e(window.google)})})}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,i;if(document.getElementById(this.id)){this.callback();return}let n={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(n).forEach(l=>!n[l]&&delete n[l]),!((i=(e=window?.google)===null||e===void 0?void 0:e.maps)===null||i===void 0)&&i.importLibrary||(l=>{let o,t,s,r="The Google Maps JavaScript API",d="google",u="importLibrary",y="__ib__",a=document,c=window;c=c[d]||(c[d]={});let f=c.maps||(c.maps={}),b=new Set,v=new URLSearchParams,I=()=>o||(o=new Promise((w,E)=>x(this,void 0,void 0,function*(){var T;yield t=a.createElement("script"),t.id=this.id,v.set("libraries",[...b]+"");for(s in l)v.set(s.replace(/[A-Z]/g,C=>"_"+C[0].toLowerCase()),l[s]);v.set("callback",d+".maps."+y),t.src=this.url+"?"+v,f[y]=w,t.onerror=()=>o=E(Error(r+" could not load.")),t.nonce=this.nonce||((T=a.querySelector("script[nonce]"))===null||T===void 0?void 0:T.nonce)||"",a.head.append(t)})));f[u]?console.warn(r+" only loads once. Ignoring:",l):f[u]=(w,...E)=>b.add(w)&&I().then(()=>f[u](w,...E))})(n);let p=this.libraries.map(l=>this.importLibrary(l));p.length||p.push(this.importLibrary("core")),Promise.all(p).then(()=>this.callback(),l=>{let o=new ErrorEvent("error",{error:l});this.loadErrorCallback(o)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){let i=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${i} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},i)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(e=>{e(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}};function O({state:h,color:e,location:i,zoom:n,disabled:p,clearButtonLabel:l}){return{state:h,color:e,location:i,zoom:n,disabled:p,clearButtonLabel:l,theme:"light",init:function(){this.theme=localStorage.getItem("theme")??getComputedStyle(document.documentElement).getPropertyValue("--default-theme-mode"),this.state!==null&&(typeof this.state=="string"||this.state instanceof String)&&(this.state=JSON.parse(this.state)),new g({apiKey:window.filamentData.api.key,version:"weekly"}).load().then(async()=>{this.loadGMaps()})},loadGMaps:async function(o){var t=!1,s=new google.maps.Map(document.getElementById("filament-drawable-map-map"),{center:{lat:this.location.latitude??0,lng:this.location.longitude??0},zoom:this.zoom??13,disableDefaultUI:!0,zoomControl:!0,gestureHandling:this.disabled?"none":"auto",clickableIcons:!this.disabled});this.applyMode(s,this.theme);var r=new google.maps.Polygon({strokeColor:this.color??"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:this.color??"#FF0000",fillOpacity:.35,draggable:!1,geodesic:!0,editable:t});let d=document.createElement("div"),u=this.createClearControl(s);if(u.disable(),d.appendChild(u),s.controls[google.maps.ControlPosition.TOP_CENTER].push(d),google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(){var a=new google.maps.LatLngBounds;return this.getPath().forEach(function(c,f){a.extend(c)}),a}),google.maps.Map.prototype.clearZone||(google.maps.Map.prototype.clearZone=function(){if(r){r.setMap(null);let a=r.getPath();a.clear(),this.sync(r,a)}u.disable()}.bind(this)),window.addEventListener("theme-changed",a=>{this.theme=a.detail,this.applyMode(s,this.theme)}),this.state!==null){let a=r.getPath();this.state.forEach((c,f)=>{let b=new google.maps.LatLng(c.lat,c.lng);a.push(b)});var y=r.getBounds();y&&(s.fitBounds(y),s.panToBounds(y)),u.enable(),r.setMap(s)}if(this.disabled)google.maps.event.clearListeners(s),google.maps.event.clearInstanceListeners(s);else{s.addListener("click",function(c){c.domEvent.ctrlKey?(r&&(r.getPath().push(c.latLng),r.getMap()||r.setMap(s)),u.disabled&&u.enable()):s.panTo(c.latLng)}),document.addEventListener("keyup",function(c){c.key==="Control"&&(t=!1,r&&r.setEditable(t),s.setOptions({draggableCursor:"",draggingCursor:""}))}),document.addEventListener("keydown",function(c){c.key==="Control"&&(t=!0,r&&r.setEditable(t),s.setOptions({draggableCursor:"crossHair",draggingCursor:"crossHair"}))}),r.addListener("dblclick",function(c){r.getEditable()&&c.vertex!==void 0&&r.getPath().removeAt(c.vertex)}),r.addListener("click",function(c){var f=r.getBounds();f&&(s.fitBounds(f),s.panToBounds(f))});let a=r.getPath();a.addListener("insert_at",()=>this.sync(r,a)),a.addListener("remove_at",()=>this.sync(r,a)),a.addListener("set_at",()=>this.sync(r,a))}},createClearControl:function(o){let t=document.createElement("button");return t.style.backgroundColor="#fff",t.style.border="2px solid #fff",t.style.borderRadius="3px",t.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",t.style.color="rgb(25,25,25)",t.style.cursor="pointer",t.style.fontFamily="Roboto,Arial,sans-serif",t.style.fontSize="16px",t.style.lineHeight="38px",t.style.margin="8px 0 22px",t.style.padding="0 5px",t.style.textAlign="center",t.textContent=this.clearButtonLabel,t.title=this.clearButtonLabel,t.type="button",t.disable=()=>{t.disabled=!0,t.style.color="rgb(195,195,195)"},t.enable=()=>{t.disabled=!1,t.style.color="rgb(25,25,25)"},t.addEventListener("click",()=>{o.clearZone()}),t},sync:function(o,t){if(o&&o.getMap()&&t.length>0){let s=t.getArray().map(r=>new google.maps.LatLng(r.lat(),r.lng()));this.state=s}else t.length===0&&(this.state=null)},applyMode(o,t){let s=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}];o!==null&&t==="dark"?o.setOptions({styles:s}):o.setOptions({styles:[]})}}}export{O as default};
